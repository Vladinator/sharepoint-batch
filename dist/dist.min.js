"use strict";var __extends=this&&this.__extends||function(){var a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],a=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&a>=t.length?void 0:t)&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var a,n,o=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(a=o.next()).done;)s.push(a.value)}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s},__spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var a,n=0,o=e.length;n<o;n++)!a&&n in e||((a=a||Array.prototype.slice.call(e,0,n))[n]=e[n]);return t.concat(a||Array.prototype.slice.call(e))};!function(){t.prototype._post=function(){var e,t,r=this._options,a=this._data,n="changeset_".concat(u.createGUID());a.push("--batch_".concat(r.guid)),a.push('Content-Type: multipart/mixed; boundary="'.concat(n,'"')),a.push("Content-Transfer-Encoding: binary"),a.push("");try{for(var o=__values(r.changesets),s=o.next();!s.done;s=o.next()){var i=s.value,c=(a.push("--".concat(n)),a.push("Content-Type: application/http"),a.push("Content-Transfer-Encoding: binary"),a.push(""),a.push("".concat(r.method," ").concat(r.url+u.toParams(r.params)," HTTP/1.1")),a.push("Accept: application/json;odata=verbose"),a.push("Content-Type: application/json;odata=verbose"),r.headers);if(i&&(c=u.extend({},c),u.extend(c,i.headers)),u.isObject(c,!0))for(var p in c)a.push("".concat(p,": ").concat(c[p]));a.push("");var l=i&&i.data?JSON.stringify(i.data):null;l&&(a.push(l),a.push(""))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}a.push("--".concat(n,"--"))},t.prototype._get=function(){var e,t,r=this._options,a=this._data;a.push("--batch_".concat(r.guid)),a.push("Content-Type: application/http"),a.push("Content-Transfer-Encoding: binary"),a.push("");try{for(var n=__values(r.changesets),o=n.next();!o.done;o=n.next()){o.value;if(a.push("".concat(r.method," ").concat(r.url+u.toParams(r.params)," HTTP/1.1")),a.push("Accept: application/json;odata=verbose"),u.isObject(r.headers,!0))for(var s in r.headers)a.push("".concat(s,": ").concat(r.headers[s]));a.push("")}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.payload=function(){return this._data.join("\r\n")},t.prototype.toString=function(){return this.payload()},t.prototype.decorateJob=function(t,e){this._changesetResults?this._changesetResults.splice(0,this._changesetResults.length):this._changesetResults=[];for(var r=0;r<this._options.changesets.length;r++){var a=e[t++];u.isObject(a,!0)&&(a.job=this,a.changeset=r),this._changesetResults.push(a)}return t};var r=t;function t(t){this._options=t,this._data=[],this._changesetResults=null,u.isArray(t.changesets)&&t.changesets.length||(t.changesets=[null]),"GET"!==t.method?this._post():this._get()}f.createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},f.toParams=function(t){function s(t,r){if(Array.isArray(t))return t.map(function(t,e){return"".concat(r||"a","[").concat(e,"]=").concat(s(t))}).join("&");if(i.isObject(t)){var e,a,n=[];for(e in t)t.hasOwnProperty(e)&&(a=t[e],Array.isArray(a)?n.push(s(t[e],e)):n.push("".concat(e,"=").concat(s(t[e]))));return n.join("&")}var o="".concat(t);try{return encodeURIComponent(o)}catch(t){}return o}var i=this,t=s(t);return t.length?"".concat("?").concat(t):""},f.extend=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=!0===t[0],a=r?t[1]:t[0],r=r?t.splice(0,1):t;return Object.assign.apply(Object,__spreadArray([a],__read(r),!1))},f.isObject=function(t,e){return t&&"object"==typeof t&&(!e||!this.isArray(t))},f.isArray=function(t){return Array.isArray(t)},f.ajax=function(n){var a=new XMLHttpRequest,o=(this.extend(n,{xhr:a,method:"GET",headers:{}}),function(t){for(var e,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];n.fail&&(e=n.fail).call.apply(e,__spreadArray([n,n],__read(r),!1)),n.always&&(e=n.always).call.apply(e,__spreadArray([n,n],__read(r),!1)),n.after&&(e=n.after).call.apply(e,__spreadArray([n,n],__read(r),!1))});if(a.addEventListener("progress",function(t){for(var e,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];n.progress&&(e=n.progress).call.apply(e,__spreadArray([n,n],__read(r),!1))}),a.addEventListener("load",function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(2!=(a.status/100|0))return o.call.apply(o,__spreadArray([n,t],__read(e),!1));n.done&&(t=n.done).call.apply(t,__spreadArray([n,n],__read(e),!1)),n.always&&(t=n.always).call.apply(t,__spreadArray([n,n],__read(e),!1)),n.after&&(t=n.after).call.apply(t,__spreadArray([n,n],__read(e),!1))}),a.addEventListener("error",o),a.addEventListener("abort",o),n.method&&n.url&&a.open(n.method,n.url),a.setRequestHeader("Accept","application/json;odata=verbose"),n.headers&&this.isObject(n.headers,!0))for(var t in n.headers)a.setRequestHeader(t,n.headers[t]);return n.mime&&a.overrideMimeType(n.mime),n.before&&n.before.call(n,n),a.send(n.data),n},f.prototype.append=function(t){var e=this._changesetSlots;if((e-=t.changesets.length)<0)return-1;this._changesetSlots=e;e=new r(t);return this._jobs.push(e)-1},f.prototype.remove=function(t){return this._jobs.splice(t,1)[0]},f.prototype.payload=function(){return this._jobs.map(function(t){return t.payload()}).join("\r\n")},f.prototype.toString=function(){return this.payload()},f.prototype.send=function(e){var r=this,t={method:"POST",url:"".concat(this._options.url,"/_api/$batch"),headers:{"X-RequestDigest":this._options.digest,"Content-Type":'multipart/mixed; boundary="batch_'.concat(this._guid,'"')},data:"".concat(this.payload(),"--batch_").concat(this._guid,"--")},a=(f.extend(e,t),f.extend({},e));return e.done=function(){var t=r._parseResponse(e.xhr.responseText);r._decorateJobs(t),a.done&&a.done.call(a,a,t)},e.fail=function(){var t=r._parseResponse(e.xhr.responseText);r._decorateJobs(t),a.fail&&a.fail.call(a,a,t)},e.always=function(){a.always&&a.always.call(a,a)},f.ajax(e)},f.prototype.spawn=function(t){return new f(t)},f.prototype._parseResponse=function(t){var e,r,a;if(!t)return null;try{return JSON.stringify(t)}catch(t){}var n,o=f._parseLevels,t=t.split(f._parseLineSeparatorPattern),s=[],i=null,c=o.UNKNOWN;try{for(var p=__values(t),l=p.next();!l.done;l=p.next()){var u,_,h,d=l.value;if(f._parseBatchResponsePattern1.test(d)){i&&(i.data=this._parseResponse(i.data),s.push(i),i=null),c=o.EOF;break}if(f._parseBatchResponsePattern2.test(d))i&&(i.data=this._parseResponse(i.data),s.push(i)),n=i={headers:{},http:{status:0,statusText:""},data:null},c=o.HEADERS;else if(c===o.REQUEST_BODY)null==n.data&&(n.data=""),n.data+=d;else if(f._parseBatchResponsePattern3.test(d))c===o.REQUEST&&(u=d.match(f._parseBatchResponsePattern3),n.http.status=u&&parseInt(u[1],10),n.http.statusText=u&&u[2],c=o.REQUEST_HEADERS);else if(/^.+:\s*.+$/i.test(d))c!==o.HEADERS&&c!==o.REQUEST_HEADERS||(_=d.split(f._parseHeaderSeparatorPattern))&&(h=null==(a=_.shift())?void 0:a.trim())&&(n.headers[h]=_.join(f._parseHeaderSeparator).trim());else if(/^[\s\r\n]*$/i.test(d))switch(c){case o.HEADERS:c=o.REQUEST;break;case o.REQUEST:c=o.REQUEST_HEADERS;break;case o.REQUEST_HEADERS:c=o.REQUEST_BODY}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}return s},f.prototype._decorateJobs=function(t){var e,r,a=0;try{for(var n=__values(this._jobs),o=n.next();!o.done;o=n.next())a=o.value.decorateJob(a,t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},f._parseLevels={UNKNOWN:0,HEADERS:1,REQUEST:2,REQUEST_HEADERS:3,REQUEST_BODY:4,EOF:5},f._parseLineSeparatorPattern=/\r\n/,f._parseHeaderSeparatorPattern=/:/,f._parseHeaderSeparator=":",f._parseBatchResponsePattern1=/^--batchresponse_.+--$/i,f._parseBatchResponsePattern2=/^--batchresponse_.+$/i,f._parseBatchResponsePattern3=/^HTTP\/1\.1\s+(\d+)\s+(.+)$/i;var u=f;function f(t){this._options=f.extend({},t),this._guid=f.createGUID(),this._jobs=[],this._changesetSlots=100}__extends(n,a=u),n.prototype._spawn=function(){return new n(this.__options)},n.prototype._append=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=-1,a=0;a<t.length;a++){var n=t[a];n instanceof u?(this.__jobs.push(n),r++):u.isObject(n,!0)&&(r++,this.__currentJob.append(n)<0&&(this.__currentJob=this.__currentJob.spawn(this.__currentJob._options),this.__currentJob.append(n),this.__jobs.push(this.__currentJob)))}return r},n.prototype._remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],a=0;a<t.length;a++){var n=t[a],o=this.__jobs.indexOf(n);-1<o&&r.push.apply(r,__spreadArray([],__read(this.__jobs.splice(o,1)),!1));for(var s=0;s<this.__jobs.length;s++){var i=this.__jobs[s];u.isObject(i._jobs,!0)&&-1<(o=i._jobs.indexOf(n))&&r.push.apply(r,__spreadArray([],__read(i._jobs.splice(o,1)),!1))}}return r.length?r:null},n.prototype._send=function(n){n=u.extend({},n);var e=this.__jobs,o=[],s=0,i=(n.before&&n.before.call(n,n,e,o),function(){var r,t,a=e[s];a?(r=function(t){u.isArray(t)?o.push.apply(o,__spreadArray([],__read(t),!1)):o.push(t)},t=u.extend({},n,{done:function(t,e){r(e)},fail:function(t,e){r(e)},always:function(t,e){n.progress&&n.progress.call(n,n,a,o),s++,i()}}),a.send(t)):(n.done&&n.done.call(n,n,e,o),n.always&&n.always.call(n,n,e,o),n.after&&n.after.call(n,n,e,o))});i()};var a,e=n;function n(t){var e=a.call(this,t)||this;return e.__options=t,e.__jobs=[],e.__currentJob=new u(t),e.__jobs.push(e.__currentJob),e}window.SharePointBatch=u,window.SharePointBatchUtil=e}();import{__awaiter,__generator}from"tslib";import fetch from"node-fetch";import{extend}from"utils";var fallback={method:"GET"},Request=function(r){return __awaiter(void 0,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return extend(r,fallback),[4,fetch(r.url,r)];case 1:return e=t.sent(),console.warn(e.ok,e.status,e.statusText),[2,e]}})})};import{__awaiter,__generator}from"tslib";import{Request}from"request";__awaiter(void 0,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Request({method:"GET",url:"https://google.com"})];case 1:return t.sent(),[4,Request({method:"GET",url:"http://google.com"})];case 2:return t.sent(),[2]}})});import{__read,__spreadArray}from"tslib";var isArray=function(t){return Array.isArray(t)},isObject=function(t,e){return void 0===e&&(e=!1),t&&"object"==typeof t&&(!e||!isArray(t))},extend=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return Object.assign.apply(Object,__spreadArray([t],__read(e),!1))};export{Request,isArray,isObject,extend};